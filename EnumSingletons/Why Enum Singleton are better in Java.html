<html>
<body>
<a href='http://javarevisited.blogspot.gr/2012/07/why-enum-singleton-are-better-in-java.html' title='Why Enum Singleton are better in Java'>
Why Enum Singleton are better in Java
</a>
</h1>
<div class='post-header'>
<div class='post-header-line-1'></div>
<div style='float:right; margin:5px 6px 0px 5px'>
                      
</div>
<div style='float:right; margin:5px 6px 0px 5px'>
</div>
</div>
<div class='post-body entry-content'>
<div dir="ltr" style="text-align: left;" trbidi="on">
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><span style="font-family: Arial; font-size: 9pt;">Enum Singletons</span></b><span style="font-family: Arial; font-size: 9pt;"> are new way to implement Singleton pattern in Java by using Enum with just one instance. Though Singleton pattern in Java exists from long time Enum Singletons are relatively new concept and in practice from Java 5 onwards after introduction of Enum as keyword and feature. This article is somewhat related to my earlier post on Singleton, <a href="http://javarevisited.blogspot.sg/2011/03/10-interview-questions-on-singleton.html">10 interview questions on Singleton pattern in Java</a> where we have discussed common questions asked on interviews about Singleton pattern and <a href="http://javarevisited.blogspot.in/2011/08/enum-in-java-example-tutorial.html">10 Java enum examples</a>, where we have seen how versatile enum can be. This post is about <b style="mso-bidi-font-weight: normal;">why should we use Enum as Singleton in Java</b>, What benefit it offers compared to conventional singleton methods etc.</span><br />
<a name='more'></a></div>
<div class="MsoNormal">
<br /></div>
<h2>
<u><span style="font-style: normal; font-weight: normal;">Java Enum and Singleton Pattern</span></u></h2>
<div class="MsoNormal">

<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">1) Enum Singletons are easy to write</span></u></b><u><span style="font-family: Arial; font-size: 9pt;"> </span></u></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">This is by far biggest advantage, if you have been writing Singletons prior to Java 5 than you know that even with double checked locking you can have more than one instances. though that issue is fixed with Java memory model improvement and gurantee provided by volatile variables from Java 5 onwards but it still tricky to write for many beginners. compared to double checked locking with synchronization Enum singletons are cake walk. If you don't believe than just compare below code for conventional singleton with double checked locking and Enum Singletons:</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">Singleton using Enum in Java</span></u></b></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">This is the way we generally declare Enum Singleton , it may contain instance variable and instance method but for sake of simplicity I haven&#8217;t used any, just beware that if you are using any instance method than you need to ensure thread-safety of that method if at all it affect the state of object. By default creation of Enum instance is thread safe but any other method on Enum is programmers responsibility.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal" style="background: #F3F3F3;">
<b><i><span style="color: green; font-family: &quot;Courier New&quot;; font-size: 9pt;">/**<br />
* Singleton pattern example using Java Enumj<br />
*/</span></i></b><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;"></span></b></div>
<div class="MsoNormal" style="background: #F3F3F3;">
<b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">public</span></b><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;"> <b><span style="color: black;">enum</span></b> EasySingleton<span style="color: #009900;">{</span><br />
&nbsp; &nbsp; INSTANCE<span style="color: #339933;">;</span><br />
<span style="color: #009900;">}</span></span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">You can acess it by </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">EasySingleton.INSTANCE</span><span style="font-family: Arial; font-size: 9pt;">, much easier than calling </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">getInstance()</span><span style="font-family: Arial; font-size: 9pt;"> method on Singleton.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">Singleton example with double checked locking</span></u></b></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">Below code is an example of double checked locking in Singleton pattern, here </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">getInstance()</span><span style="font-family: Arial; font-size: 9pt;"> method checks two times to see whether INSTANCE is null or not and that&#8217;s why it&#8217;s called double checked locking pattern, remember that double checked locking is broker before Java 5 but with the guranteed of <a href="http://javarevisited.blogspot.com/2011/06/volatile-keyword-java-example-tutorial.html">volatile variable in Java 5</a> memory model, it should work perfectly.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal" style="background: #F0F0F0;">
<b><i><span style="color: green; font-family: &quot;Courier New&quot;; font-size: 9pt;">/**<br />
* Singleton pattern example with Double checked Locking<br />
*/</span></i></b><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;"></span></b></div>
<div class="MsoNormal" style="background: #F0F0F0;">
<b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">public</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">class</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> DoubleCheckedLockingSingleton</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">{</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp;</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">private</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">volatile</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> DoubleCheckedLockingSingleton INSTANCE</span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">;</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; <br />
&nbsp; &nbsp; &nbsp;</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">private</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> DoubleCheckedLockingSingleton</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(){}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; <br />
&nbsp; &nbsp; &nbsp;</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">public</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> DoubleCheckedLockingSingleton getInstance</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(){</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">if</span></b><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;">INSTANCE </span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">==</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> <b>null</b></span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">){</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">synchronized</span></b><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;">DoubleCheckedLockingSingleton.</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">class</span></b><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">){</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><i><span style="color: #666666; font-family: &quot;Courier New&quot;; font-size: 9pt;">//double checking Singleton instance</span></i><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">if</span></b><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;">INSTANCE </span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">==</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> <b>null</b></span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">){</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; INSTANCE </span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">=</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">new</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> DoubleCheckedLockingSingleton</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">()</span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">;</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">return</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> INSTANCE</span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">;</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp;</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"></span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">You can call </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">DoubleCheckedLockingSingleton.getInstance() </span><span style="font-family: Arial; font-size: 9pt;">to get access of this Singleton class.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">Now Just look at amount of code needed to create a <b style="mso-bidi-font-weight: normal;">lazy loaded thread-safe Singleton</b>. With Enum Singleton pattern you can have that in one line because creation of Enum instance is <a href="http://javarevisited.blogspot.sg/2012/01/how-to-write-thread-safe-code-in-java.html">thread-safe</a> and guranteed by JVM.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">People may argue that there are better way to write Singleton instead of Double checked locking approach but every approach has there own advantages and disadvantages like I mostly prefer static field Singleton intialized during classloading as shwon in below example, but keep in mind that is not a <b style="mso-bidi-font-weight: normal;">lazy loaded Singleton</b>:</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">Singleton pattern with static factory method</span></u></b></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">This is one of my favorite method to impelemnt Singleton pattern in Java, Since Singleton instance is <a href="http://javarevisited.blogspot.sg/2011/11/static-keyword-method-variable-java.html">static</a> and <a href="http://javarevisited.blogspot.sg/2011/12/final-variable-method-class-java.html">final variable</a> it initialized when class is first loaded into memeory so creation of instance is inherently thread-safe.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal" style="background: #F3F3F3;">
<b><i><span style="color: green; font-family: &quot;Courier New&quot;; font-size: 9pt;">/**<br />
* Singleton pattern example with static factory method<br />
*/</span></i></b><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
<br />
<b><span style="color: black;">public</span></b> <b><span style="color: black;">class</span></b> Singleton<span style="color: #009900;">{</span><br />
&nbsp; &nbsp; <i><span style="color: #666666;">//initailzed during class loading</span></i><br />
&nbsp; &nbsp; <b><span style="color: black;">private</span></b> <b><span style="color: black;">static</span></b> <b><span style="color: black;">final</span></b> Singleton INSTANCE <span style="color: #339933;">=</span> <b><span style="color: black;">new</span></b> Singleton<span style="color: #009900;">()</span><span style="color: #339933;">;</span><br />
&nbsp; <br />
&nbsp; &nbsp; <i><span style="color: #666666;">//to prevent creating another instance of Singleton</span></i><br />
&nbsp; &nbsp; <b><span style="color: black;">private</span></b> Singleton<span style="color: #009900;">(){}</span><br />
<br />
&nbsp; &nbsp; <b><span style="color: black;">public</span></b> <b><span style="color: black;">static</span></b> Singleton getSingleton<span style="color: #009900;">(){</span><br />
&nbsp; &nbsp; &nbsp; &nbsp; <b><span style="color: black;">return</span></b> INSTANCE<span style="color: #339933;">;</span><br />
&nbsp; &nbsp; <span style="color: #009900;">}</span><br />
<span style="color: #009900;">}</span></span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">You can call </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">Singleton.getSingleton()</span><span style="font-family: Arial; font-size: 9pt;"> to get access of this class.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">2) Enum Singletons handled Serialization by themselves</span></u></b></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">Another problem with conventional Singletons are that once you implement <a href="http://javarevisited.blogspot.sg/2011/04/top-10-java-serialization-interview.html">serializable interface</a> they are no longer remain Singleton because </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">readObject()</span><span style="font-family: Arial; font-size: 9pt;"> method always return a new instance just like constructor in Java. you can avoid that by using </span><span style="font-family: &quot;Courier New&quot;; font-size: 9pt;">readResolve()</span><span style="font-family: Arial; font-size: 9pt;"> method and discarding newly created instance by replacing with Singeton as shwon in below example :</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal" style="background: #F0F0F0;">
<i><span style="color: #666666; font-family: &quot;Courier New&quot;; font-size: 9pt;">&nbsp;&nbsp;&nbsp; //readResolve to prevent another instance of Singleton</span></i><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">private</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> Object readResolve</span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">(){</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; &nbsp; &nbsp; </span><b><span style="color: black; font-family: &quot;Courier New&quot;; font-size: 9pt;">return</span></b><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"> INSTANCE</span><span style="color: #339933; font-family: &quot;Courier New&quot;; font-size: 9pt;">;</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"><br />
&nbsp; &nbsp; </span><span style="color: #009900; font-family: &quot;Courier New&quot;; font-size: 9pt;">}</span><span style="color: #000066; font-family: &quot;Courier New&quot;; font-size: 9pt;"></span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">This can become even more complex if your Singleton Class maintain state, as you need to make them <a href="http://javarevisited.blogspot.sg/2012/03/difference-between-transient-and.html">transient</a>, but witn <b style="mso-bidi-font-weight: normal;">Enum Singleton</b>, Serialization is guarnateed by JVM.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<b style="mso-bidi-font-weight: normal;"><u><span style="font-family: Arial; font-size: 9pt;">3) Creation of Enum instance is thread-safe</span></u></b></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">As stated in point 1 since creatino of Enum instance is thread-safe by default you don't need to worry about double checked locking.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">
<span style="font-family: Arial; font-size: 9pt;">In summary, given the <b style="mso-bidi-font-weight: normal;">Serialzation and thraead-safety guaranteed</b> and with couple of line of code enum Singleton pattern is best way to create Singleton in Java 5 world. you can still use other popular methods if you feel so but I still have to find a <i style="mso-bidi-font-style: normal;">convincing reason not to use Enum as Singleto</i>n, let me know if you got any.</span></div>
<div class="MsoNormal">
<br /></div>
<div class="MsoNormal">

</body>
</html>